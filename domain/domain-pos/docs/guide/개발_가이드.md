## 아키텍처(Layerd Architecture)

---

- Service >> Implement >> Repository
    - 레거시에는 Service 계층이 Repository를 의존할 수 없었음 (계층 건너뛰기가 안됨)
    - 리팩터링 후 Service 계층이 Repository 를 의존할 수 있음
    - Implement 계층의 사용을 자제 (validation 같은 모든 에그리거트에서 사용해야할 코드라면 사용 가능)
    - 같은 계층간에는 호출이 안됨

## Transaction Script vs Domain Model

---

- **도메인 모델 방식을 적극 사용하는 것을 권장**
- 레거시에는 도메인에 해당하는 모든 로직들이 Implement 에 구현되고 Service 에서 이를 조합하는 방식이었음
    - 공통으로 많이 사용되는 로직인 경우에는 Implement 계층에 구현하는 방법이 용이함
    - 하지만 의미없는 코드 Repository 를 호출하는 역할이 전부인 코드가 반복적으로 동작함
    - 또한 도메인 로직의 가시성이 적음 Implement와 도메인 엔티티를 스크래핑하면서 파일을 돌아다니며 한눈에 보기 어려움
    - 도메인 엔티티의 의미가 퇴색함
        - 현재 프로젝트는 JPA와 Spring 의존성이 없는 순수 POJO 방식의 엔티티로 도메인 엔티티를 사용함
        - 하지만 도메인 엔티티에는 도메인적인 Operation 이 없음 (계층간 이동에서 데이터를 저장하는 DTO 역할로만 쓰임 )

## 도메인 모델 방식의 문서화와 개발 가이드

---

- 도메인 모델 방식에는 Domain 을 정의하고 Domain Model 을 추출하는 것이 선행되어야 함
- 도메인이란 우리 애플리케이션이 바라보는 문제의 영역(혹은 분야)이다.
- 우리 서비스가 바라보는 큰 도메인은 작은 도메인으로 분리될 수 있다(store, order, ...)
- 해당 도메인을 글로 작성해보자 (보통은 도메인 이해관계자 모두가 문서를 작성한다.)
- 글로 작성된 도메인을 도메인 모델로 추상화하자.
- 도메인 모델이란 도메인을 애플리케이션 관점에서 이해한 도메인의 추상화된 레밸이다.
- 여러가지 도메인을 추상화하는 방법이 있겠지만 우리 팀은 도메인에 개념(Aggregate) 과 개념의 속성(Property), 행위(Behavior), 제약(constraints) 정의하는 방법을 사용한다.

## Aggregate를 정의하는 가이드

---

- 어느 영역까지 같은 Aggregate로 묶을 것인가에 대한 고민이 생기는 것은 자연스러운 것임
- 보통은 LifeCycle이 같은 것들끼리 묶는 것을 권장함
    - 하지만 이 방법도 완벽하지 않음, 애매할 때는 팀과 소통 혹은 회의를 하자

## 다른 Aggregate 사이의 결합

---

- LifeCycle이 다른 Aggregate 사이의 결합은 지양해야 함
- 하지만 어쩔 수 없이 Aggregate 사이의 결합이 필요한 경우에는
    - Aggregate 간의 관계는 식별자(Identifier)로만 연결하는 것을 권장함
    - Aggregate 간의 관계는 단방향으로만 연결하는 것을 권장함
    - 이래도 애매하다면 팀과 회의를 해보자

## Aggregate Root 를 사용한 제약

---

- Aggregate Root 는 해당 Aggregate 의 생명주기를 관리하는 역할을 한다.
- Aggregate Root 를 통해서만 포함되는 부속 Aggregate들에 행위를 가할 수 있다.
    - 보통은 부속 Aggregate 들의 행위는 Package private 로 하자

## Test 코드를 작성하는 방법

--- 

- 도메인 모델링을 통한 설계는 언제든지 변경 가능하고 변경되는 것이 자연스럽다.
- 빠르게 설계하고 도메인의 행위에 대한 Test 코드를 작성하자.
- 도메인 엔티티 테스트(지향)
- 도메인 엔티티의 public API(Operation) 은 해당 엔티티가 가지는 책임을 의미함
    - Test 코드로 도메인 엔티티가 해당 책임을 완수하는지 검증하자
- Service 계층의 단위 테스트 (자유)
    - Service 계층의 단위 테스트는 도메인 엔티티의 행위를 조합하는 역할을 한다.
        - 레거시와 다르게 도메인 로직의 책임이 없어졌다.
    - 검증이 필요하다고 느끼는 부분만 테스트 코드를 진행하자 (강제하진 않는다.)
- Service - Repository - RDB 통합 테스트 (지향)
    - 해당 Service 가 정상 작동하는지 쿼리는 어떻게 나가는지 Test 코드로 검증하자

## domain 패키지 구조

---

### entity

- dto
    - 도메인 요소로 필요한 DTO
- 도메인 엔티티

### port

- 도메인 모듈이 외부와 통신하기 위한 통로
- provided
    - 도메인 모듈이 외부에 제공하는 인터페이스
- required
    - 도메인 모듈이 외부에서 사용하는 인터페이스

### adapter

- 도메인 모듈이 외부와 통신하기 위한 인터페이스 구현체 도메인 모듈이 제공하는 service 가 포함됨
- 내부 패키지는 구분만 가능하게 자유 형식
- implement는 service 패키지 내부에 위치하자
